<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{page-layout}">
<head>
    <title>View clients</title>

    <style>
        .validation-error {
            color: red;
            font-size: 12px;
        }
    </style>
</head>

<div layout:fragment="main">
    <!-- Modal for client registration -->
    <form id="registration-form" th:action="@{/clients/register}" th:object="${newClient}"
          onsubmit="return validateGender();" method="post">
        <div class="modal fade" id="custom-modal" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header bg-light">
                        <h4 class="modal-title" id="myCenterModalLabel">Register client</h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-hidden="true"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label id="firstNameLabel" for="registration-first-name" class="form-label">First
                                Name</label>
                            <input type="text" class="form-control" id="registration-first-name"
                                   placeholder="Enter first name" th:field="*{firstName}" minlength="2"
                                   maxlength="50" pattern="^[a-zA-Z]{2,50}$"
                                   title="First name must be between 2 and 50 characters long." required>
                            <span class="validation-error" th:if="${#fields.hasErrors('firstName')}"
                                  th:errors="*{firstName}"></span>
                        </div>
                        <div class="mb-3">
                            <label id="lastNameLabel" for="registration-last-name" class="form-label">Last Name</label>
                            <input type="text" class="form-control" id="registration-last-name"
                                   placeholder="Enter last name" th:field="*{lastName}" minlength="2"
                                   maxlength="50" pattern="^[a-zA-Z]{2,50}$"
                                   title="Last name must be between 2 and 50 characters long." required>
                            <span class="validation-error" th:if="${#fields.hasErrors('lastName')}"
                                  th:errors="*{lastName}"></span>
                        </div>
                        <div class="mb-3">
                            <label id="dateOfBirthLabel" for="registration-date-of-birth" class="form-label">Date Of
                                Birth</label>
                            <input type="date" class="form-control" id="registration-date-of-birth"
                                   th:field="*{dateOfBirth}" required>
                            <span class="validation-error" th:if="${#fields.hasErrors('dateOfBirth')}"
                                  th:errors="*{dateOfBirth}"></span>
                        </div>
                        <div>
                            <label class="form-label">Gender</label>
                            <div class="form-check mb-1">
                                <label>Male
                                    <input type="radio" id="registration-male-radio-button" name="gender"
                                           class="form-check-input" value="M" th:field="*{gender}">
                                </label>
                            </div>
                            <div class="form-check form-check-pink">
                                <label>Female
                                    <input type="radio" id="registration-female-radio-button" name="gender" value="F"
                                           th:field="*{gender}" class="form-check-input">
                                </label><br>
                            </div>
                            <div class="mb-3" th:switch="${#fields.hasErrors('gender')}">
                                <!--suppress XmlDuplicatedId -->
                                <span id="genderError" class="validation-error" th:case="${true}"
                                      th:errors="*{gender}"></span>
                                <!--suppress XmlDuplicatedId -->
                                <span id="genderError" class="validation-error" th:case="*"></span>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label id="emailLabel" for="registration-email" class="form-label">Email Address</label>
                            <input type="email" class="form-control" id="registration-email" placeholder="Enter email"
                                   th:field="*{email}" minlength="3" maxlength="50" required>
                            <span class="validation-error" th:if="${#fields.hasErrors('email')}"
                                  th:errors="*{email}"></span>
                        </div>
                        <div class="mb-3">
                            <label id="phoneLabel" for="registration-phone" class="form-label">Phone</label>
                            <input type="tel" class="form-control" id="registration-phone" placeholder="Enter phone"
                                   th:field="*{phone}" minlength="8" maxlength="20" pattern="^[0-9]{8,20}$"
                                   title="Phone number must be between 8 and 20 digits long." required>
                            <span class="validation-error" th:if="${#fields.hasErrors('phone')}"
                                  th:errors="*{phone}"></span>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-success">Register</button>
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->
    </form>

    <!-- Modal for client deletion -->
    <form id="delete-client-form" method="get">
        <div id="warning-alert-modal" class="modal fade" tabindex="-1" role="dialog"
             aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-body">
                        <div class="text-center">
                            <i class="dripicons-warning h1 text-warning"></i>
                            <h4 id="client-fullname-delete-modal" class="mt-2"></h4>
                            <p class="mt-3">You are about to delete this client. Do you want to continue?</p>
                            <button type="submit" class="btn btn-warning my-2">Continue</button>
                            <button type="button" class="btn btn-danger my-2" data-bs-dismiss="modal">Cancel</button>
                        </div>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->
    </form>

    <!-- Modal for edit client -->
    <form id="edit-client-form" method="get">

    </form>

    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="row justify-content-between">
                        <div class="col-md-4">
                            <div class="mt-3 mt-md-0">
                                <button class="btn btn-lg font-16 btn-success" data-bs-toggle="modal"
                                        id="registrationFormButton" data-bs-target="#custom-modal"><i
                                        class="fa fa-plus me-1"></i> Register client
                                </button>
                            </div>
                        </div><!-- end col-->
                        <div class="col-md-8">
                            <form class="d-flex flex-wrap align-items-center justify-content-sm-end">
                                <label for="status-select" class="me-2">Sort By</label>
                                <div class="me-sm-2">
                                    <select class="form-select my-1 my-md-0" id="status-select">
                                        <option value="1" selected>First Name</option>
                                        <option value="2">Last Name</option>
                                        <option value="3">Gender</option>
                                    </select>
                                </div>
                                <label for="inputPassword2" class="visually-hidden">Search</label>
                                <div>
                                    <input type="search" class="form-control my-1 my-md-0" id="inputPassword2"
                                           placeholder="Search...">
                                </div>
                            </form>
                        </div>
                    </div> <!-- end row -->
                </div>
            </div> <!-- end card -->
        </div><!-- end col-->
    </div>
    <!-- end row -->
    <div class="row" th:with="maleImg=@{/images/users/male.png}, femaleImg=@{/images/users/female.png}">
        <div class="col-xl-4" th:each="client :${clients}">
            <div class="card">
                <div class="text-center card-body">
                    <div class="dropdown float-end">
                        <a class="dropdown-toggle arrow-none card-drop" data-bs-toggle="dropdown"
                           aria-expanded="false">
                            <i class="mdi mdi-dots-vertical"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end">
                            <a class="dropdown-item">Edit profile</a>
                            <a class="dropdown-item" data-bs-toggle="modal"
                               data-bs-target="#warning-alert-modal"
                               th:onclick="fillDeleteModal([[${client.getFullName()}]],[[${client.id}]])">Delete
                                client</a>
                        </div>
                    </div>
                    <div>
                        <img th:src="${client.gender.toString() == 'F'} ? ${femaleImg} : ${maleImg}"
                             class="rounded-circle avatar-xl img-thumbnail mb-2" alt="profile-image">

                        <div class="text-start">
                            <p class="text-muted font-13"><strong>First Name :</strong> <span
                                    class="ms-1" th:text="${client.firstName}"></span>
                            </p>

                            <p class="text-muted font-13"><strong>Last Name :</strong> <span
                                    class="ms-1" th:text="${client.lastName}"></span>
                            </p>

                            <p class="text-muted font-13"><strong>Date Of Birth :</strong> <span
                                    class="ms-1" th:text="${client.getFormattedDateOfBirth()}"></span>
                            </p>

                            <p class="text-muted font-13"><strong>Phone :</strong><span
                                    class="ms-1" th:text="${client.phone}"></span></p>

                            <p class="text-muted font-13"><strong>Email :</strong> <span class="ms-1"
                                                                                         th:text="${client.email}"></span>
                            </p>
                        </div>

                        <button type="button" class="btn btn-primary rounded-pill waves-effect waves-light">Send
                            Message
                        </button>
                    </div>
                </div>
            </div>
        </div> <!-- end col -->
    </div>
    <!-- end row -->

    <!-- Custom scripts -->
    <th:block th:if="${registrationValidationFailed}">
        <script>
            <!-- Server-side registration validation returned errors. Open the registration form modal -->
            window.onload = function () {
                document.getElementById('registrationFormButton').click();
            }
        </script>
    </th:block>

    <script>
        // Change page title.
        const title = document.getElementsByClassName("page-title-main");
        title[0].textContent = "Clients";

        // Reset registration form and validation errors on modal close.
        document.getElementById("custom-modal").onhidden = function () {
            document.getElementById("registration-form").reset();
            document.getElementsByClassName("validation-error").forEach(element => {
                element.textContent = "";
            });
        }

        function validateGender() {
            // Validate gender radio buttons, if none is selected, display an error message and prevent form submission.
            const maleRadioButton = document.getElementById("maleRadioButton");
            const femaleRadioButton = document.getElementById("femaleRadioButton");
            if (maleRadioButton.checked || femaleRadioButton.checked) {
                document.getElementById("genderError").textContent = "";
                return true;
            }
            document.getElementById("genderError").textContent = "Gender is required.";
            return false;
        }

        function fillDeleteModal(clientName, id) {
            // Fill the delete modal with the client's full name and set the form action to the client's id.
            document.getElementById("client-fullname-delete-modal").textContent = clientName;
            document.getElementById("delete-client-form").setAttribute("action", "/clients/delete/" + id)
        }
    </script>
</div>
</html>